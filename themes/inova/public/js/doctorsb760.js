"use strict";function ownKeys(t,e){var o,n=Object.keys(t);return Object.getOwnPropertySymbols&&(o=Object.getOwnPropertySymbols(t),e&&(o=o.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,o)),n}function _objectSpread(t){for(var e=1;e<arguments.length;e++){var o=null!=arguments[e]?arguments[e]:{};e%2?ownKeys(Object(o),!0).forEach(function(e){_defineProperty(t,e,o[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(o)):ownKeys(Object(o)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(o,e))})}return t}function _defineProperty(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}!function(f){var o={};o.settings={selectors:{form_submit:".doctors-form-submit",form:"#doctors-search-form",reset_search:".reset-search"},route:"".concat(drupalSettings.path.baseUrl).concat(drupalSettings.path.currentPath)},o.init=function(){this.englishFix(),this.attachFormSubmission(),this.favoriteItem(),this.buildSelects(),this.attachSearchReset(),this.searchByTypeDropDown(),this.toggleSearchFormAndResults(),this.searchByName(),this.handleFormSubmissions(),this.setFormFieldsCurrentState(),this.fieldToggle.toggleSpeciality(),this.searchByPractice(),this.removePrimaryFromSpecialtyInput(),this.showAll(),this.radiusTooltip()},o.punctuateMiddleInitial=function(e){f(".middle-initial",e).each(function(){var e=f(this).text();e.includes(".")||1!==e.length||f(this).append(".")})},o.heroSaveDoctor=function(e){0<f(".doctor-wrap").length&&f(".doctor-wrap").favoriteItem({container:'[role="banner"]',cookieName:"savedDoctor",button:"button.save",parent:".save-wrap",dataAttr:"doctor",link:"/doctors?saved=1",text:"Doctor"})},o.formSubmit=function(){var e=f(this.settings.selectors.form);f("#formatted_address");void 0!==getAllUrlParams().specialty&&f("#specialty").attr("value",decodeURIComponent(getAllUrlParams().specialty)),e.submit()},o.attachFormSubmission=function(){f(this.settings.selectors.form_submit).on("change",function(){void 0!==getAllUrlParams().specialty&&f("#specialty").attr("value",getAllUrlParams().specialty),o.formSubmit()}),f("#radius").on("change",function(e){inovaGeoLocation.hasLocation()&&o.formSubmit();var t=f("#formatted_address").val();t&&inovaGeoLocation.requestLatLngFromAddress(t).then(function(e){return o.formSubmit(),!1},function(e){return alert("Address to lat long was rejected:"+e),!1})}),inovaGeoLocation.hasLocation()&&o.toggleLocationText()},o.toggleLocationText=function(){f(".doctors-request-geolocation").toggle(),f(".doctors-remove-geolocation").toggle()},o.favoriteItem=function(){var e=f(this.settings.selectors.form);0<e.length&&e.favoriteItem({container:".listing-wrap",cookieName:"savedDoctor",button:"button.save",breadcrumbOn:!0,parent:".provider",dataAttr:"doctor",text:"Doctor",useTextInButton:!0})},o.buildSelects=function(){inovaHelpers.buildSelect("#gender",drupalSettings.doctorsLandingPage.genders,getAllUrlParams().gender).then(function(e){return f(e).selectpicker("refresh")}),inovaHelpers.buildSelect("#language",drupalSettings.doctorsLandingPage.languages,getAllUrlParams().language).then(function(e){return f(e).selectpicker("refresh")}),inovaHelpers.buildSelect("#insurance",drupalSettings.doctorsLandingPage.insurances,getAllUrlParams().insurance).then(function(e){return f(e).selectpicker("refresh")}),inovaHelpers.buildSelect("#hospital",drupalSettings.doctorsLandingPage.hospitals,getAllUrlParams().hospital).then(function(e){return f(e).selectpicker("refresh")})},o.attachSearchReset=function(){f(o.settings.selectors.reset_search).on("click",function(e){var t;e.preventDefault(),_.isEmpty(window.location.search)||"?all=1"!==window.location.search&&(t="".concat(o.settings.route,"?all=1"),inovaGeoLocation.hasLocation()?inovaGeoLocation.removeMyLocation().then(function(e){window.location.href=t}):window.location.href=t)})},o.helpers={autoComplete:{matchesHelper:function(e,t,o,n){var r=3<arguments.length&&void 0!==n&&n;e=e.toLowerCase();var a=t.map(function(e){return e[o]}),i=[],s=0,c=a;for(!0===r&&(c=t.map(function(e){return"".concat(e[o]," ").concat(e.indexExtra)})),s=0;s<c.length;s++)~c[s].toLowerCase().indexOf(e)&&i.push(a[s]);return i},getSelectedObj:function(e,t){var o=t.map(function(e){return e.name}).indexOf(e);return t[o]}}},o.searchByTypeDropDown=function(){var i,c,l,u,d,p,s={searchObject:drupalSettings.doctorsLandingPage.specialties,searchField:"#specialty",autocomplete_selector:".autocomplete-container",formSelector:this.settings.selectors.form,_this:this};function n(e){return s.searchObject[s.searchObject.map(function(e){return e.id}).indexOf(e.toString())]}function a(e){sessionStorage.setItem("current_specialty",JSON.stringify(_objectSpread({},e)))}function r(){return void 0===sessionStorage.current_specialty?{}:JSON.parse(sessionStorage.current_specialty)}i=document.querySelector(".search-by-keyword"),c=document.getElementById("specialty"),l=document.getElementById("specialtiesList"),u=s.searchObject.map(function(e){return e.name}),d=function(e){l.innerHTML="",e.forEach(function(e){var t=document.createElement("li");t.setAttribute("data-name",e),t.innerHTML=e,l.appendChild(t)})},(p={dropdownOpen:function(){document.querySelector(".specialties .bootstrap-select").addEventListener("click",function(){document.getElementById("doctors-search-form").querySelectorAll(".specialties .inner > li").forEach(function(e){e.addEventListener("click",function(e){var t,o=e.target.textContent;if("Specialty Care"===o&&(i.classList.contains("open")?i.classList.remove("open"):i.classList.add("open"),c.focus()),"Primary Care"===o){var n=(t="Primary Care",s.searchObject[s.searchObject.map(function(e){return e.name}).indexOf(t)]);if(void 0===n)return;var r,a="";a=window.location.search?(r=inovaHelpers.removeURLParameter(window.location.href,"specialty"),"".concat(r,"&specialty=").concat(n.id)):"".concat(s._this.settings.route,"?specialty=").concat(n.id),window.location.href="".concat(a,"&is_primary=true")}})})})},dropdownClose:function(){document.querySelector("body").addEventListener("click",function(o){var e=document.querySelectorAll(".filters .specialties");!i.classList.contains("open")||!1!==function(e){var t=0;if(t<e.length)return!!e[t].contains(o.target)}(e)||o.target.classList.contains("search-by-keyword")||o.target.classList.contains("autocomplete-suggestions")||i.classList.remove("open")})},keywordSelect:function(){setTimeout(function(){f("#specialtiesList li").on("click",function(e){var t=f(this).attr("data-name"),o=drupalSettings.doctorsLandingPage.specialties.filter(function(e){return e.name==t}),n={id:o[0].id,name:o[0].name};a(n);var r=document.querySelector(s.formSelector);c.value=n.id,i.classList.remove("open"),r.submit()})},2)},keywordSearch:function(){d(u),p.keywordSelect(),c.addEventListener("input",function(e){if(0===c.value.length)d(u),p.keywordSelect();else{l.innerHTML="";var t=e.target.value.toLowerCase(),o=u.filter(function(e){if(e.toLowerCase().match(t))return e}),s=[];o.forEach(function(e){var t,o,n,r,a=c.value.toLowerCase(),i=e;(e=e.toLowerCase()).includes(a)&&(t=e.indexOf(a),o="<strong>".concat(a,"</strong>"),n=a.length,r=e.slice(0,t)+o+e.slice(t+n,e.length),r='<li data-name="'.concat(i,'">').concat(r,"</li>"),s.push(r))});for(var s=s.join(""),n=(a=s,(new DOMParser).parseFromString(a,"text/html").body.querySelectorAll("li")),r=0;r<n.length;r++)l.appendChild(n[r]);p.keywordSelect()}var a})}}).dropdownOpen(),p.dropdownClose(),p.keywordSearch(),function(){var e=getAllUrlParams().specialty;if(void 0!==e&&void 0!==n(e)){var t=f("#specialties"),o=n(e).name;if("Primary Care"===o)return f("option[value='primary-care']").attr("selected",!0),t.selectpicker("refresh"),f(".specialties .filter-option-inner-inner").html(o);o!==r().name&&(o=r().name),f('[data-id="specialties"]').html(o)}}()},o.toggleSearchFormAndResults=function(){""!==window.location.search?(f("#doctors-search-form").addClass("filters-applied"),f(".search-form-results").show()):f("#doctors-search-form").removeClass("filters-applied")},o.searchByName=function(){var t="/api/doctors/suggestions",e=new URLSearchParams(location.search).get("specialty"),o=null===e||""==e?"null":e;f(this.settings.selectors.form),new autoComplete({selector:'input[id="name"]',menuClass:"name-search-filter",minChars:0,source:function(e,n){try{xhr.abort()}catch(e){}f.getJSON(t,{name:e,specialty:o},function(e,t){var o=e.map(function(e){return e.title.concat("||",e.url)});n(o)})},renderItem:function(e,t){for(var o=t.split(" "),n=e.split("||"),r=n[0].split(" "),a=[],i=!1,s=0;s<r.length;s++){i=!1;for(var c=0;c<o.length;c++)if(r[s].substring(0,o[c].length)==o[c]){a.push("<b>"+r[s].substring(0,o[c].length)+"</b>"+r[s].substring(o[c].length)),i=!0;break}0==i&&a.push(r[s])}return'<div class="autocomplete-suggestion" data-url="'+n[1]+'" data-val="'+n[0]+'">'+a.join(" ")+"</div>"},onSelect:function(e,t,o){window.location.href=window.location.origin+o.getAttribute("data-url")}})},o.refineResults=function(){f(".find-a-doctor nav.primary-search-filters button.refine-results").on("click",function(e){e.preventDefault(),f(".find-a-doctor nav.primary-search-filters .filters, .find-a-doctor .search-form-results nav.refine-search-filters").slideToggle(),f("form#doctors-search-form").toggleClass("expanded"),f(".filters-applied").hasClass("expanded")?f("button.refine-results").text("Hide Filters"):f("button.refine-results").text("Refine Results")})},o.handleFormSubmissions=function(){var n=f("form");f("input",n).each(function(e){var o=f(this);o.keypress(function(e){if(13===e.which&&"formatted_address"===o.attr("id")&&""!==o.val()){var t=o.val();return inovaGeoLocation.requestLatLngFromAddress(t).then(function(e){return void 0!==getAllUrlParams().specialty&&f("#specialty").val(getAllUrlParams().specialty),n.submit(),!1},function(e){return alert("Address to lat long was rejected:"+e),!1}),!1}13===e.which&&"name"===o.attr("id")&&(void 0!==getAllUrlParams().specialty&&f("#specialty").val(getAllUrlParams().specialty),n.submit()),13===e.which&&"practice"===o.attr("id")&&(e.preventDefault(),n.submit()),13===e.which&&"name"===o.attr("id")&&(e.preventDefault(),sessionStorage.setItem("current_name",JSON.stringify({name:o.val()})))})}),window.location.origin||(window.location.origin=window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:""))},o.setFormFieldsCurrentState=function(){var s=getAllUrlParams();_.forEach({img:"#image",accepting:"#accepting",onlinescheduling:"#online_scheduling",radius:"#radius",latitude:"#latitude",longitude:"#longitude",formatted_address:"#formatted_address",name:"#name",sort:"#sort",practice:"#practice"},function(t,e){if(void 0!==s[e]){var o,n,r=s[e],a=f(t).attr("type"),i="";switch(f(t)[0]&&(i=f(t)[0].tagName.toLowerCase()),i){case"select":f(t).val(r),f(t).selectpicker("refresh");break;case"input":switch(a){case"checkbox":1==r&&f(t).prop("checked",!0);break;case"text":"formatted_address"===e&&!0!==_.isEmpty(inovaGeoLocation.getLocation())&&f(t).val(inovaGeoLocation.getLocation().formatted_address),"practice"===e&&(o=decodeURIComponent(r).replace(/\+/g," "),!1===_.isEmpty(o)&&f.ajax({url:"/api/doctors/practices",data:{practice:o}}).done(function(e){!1===_.isEmpty(e)&&f(t).val(e[0])})),"name"===e&&(n=decodeURIComponent(r.split("+").join(" ")),f(t).val(n))}}}})},o.englishFix=function(){drupalSettings.doctorsLandingPage.languages.push({id:"",name:"English"}),drupalSettings.doctorsLandingPage.languages=_.sortBy(drupalSettings.doctorsLandingPage.languages,"name")},o.fieldToggle={toggleSpeciality:function(){void 0!==getAllUrlParams().specialty&&f(".accepting-container").show()}},o.searchByPractice=function(){new autoComplete({selector:'input[id="practice"]',menuClass:"name-search-filter",minChars:1,source:function(e,t){f.getJSON("/api/doctors/practices",{practice:e},function(e){return t(e)})}})},o.removePrimaryFromSpecialtyInput=function(){f(".specialties .dropdown-menu").on("click",function(){f("#specialty").val("")})},o.showAll=function(){void 0!==drupalSettings.path.currentQuery&&(void 0===drupalSettings.path.currentQuery.pager&&f(".doctors-all-container").hide(),"false"===drupalSettings.path.currentQuery.pager&&f("#pager").attr("value",!1),getAllUrlParams().is_primary&&f(".doctors-all-container").show())},o.radiusTooltip=function(){f(".location-radius .tooltip");f("body").on("click",function(e){f(e.target).hasClass("doctors-request-geolocation")||f(".location-radius .tooltip").fadeOut("fast",function(){f(this).remove()})}),f("#radius").on("changed.bs.select",function(){"No Preference"!==f(".location-radius button.dropdown-toggle").attr("title")&&f(".location-radius .bootstrap-select").hasClass("required")&&f(".location-radius .bootstrap-select").removeClass("required")})},f(".doctors-request-geolocation").on("click",function(e){if(e.preventDefault(),_.isEmpty(f("#radius option:selected").val())){return f(".location-radius .bootstrap-select").addClass("required"),void(0===f(".location-radius .tooltip").length&&f(".location-radius").append('<div class="tooltip">\n                                <div class="tooltip-content" style="display: block;">\n                                  <span><strong>Use My Location</strong> option requires that a radius selection is made.</span>\n                                </div>\n                              </div>'))}f(".geolocation-container").addClass("loading");inovaGeoLocation.requestLocation().then(function(e){inovaGeoLocation.requestAddress().then(function(e){o.formSubmit()},function(e){f(".geolocation-container").toggleClass("loading")})},function(e){f(".geolocation-container").toggleClass("loading")})}),f(".doctors-remove-geolocation").on("click",function(e){e.preventDefault(),inovaGeoLocation.removeMyLocation().then(function(e){window.location.href=e})}),window.inovaDoctors=o}(jQuery);